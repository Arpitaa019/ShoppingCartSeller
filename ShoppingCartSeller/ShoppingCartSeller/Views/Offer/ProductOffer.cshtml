@{
    ViewBag.Title = "Product Offers";
    Layout = "~/Views/Shared/_LayoutSellerAdmin.cshtml";
}

<h3 class="mb-4 text-success fw-semibold">Manage Product Offers</h3>
<div id="offerMessage" class="alert d-none"></div>

<form id="offerForm" class="row g-3">
    <div class="col-md-6">
        <label class="form-label">Product</label>
        <select id="ProductId" name="ProductId" class="form-select" required></select>
    </div>

    <div class="col-md-6">
        <label class="form-label">Offer Title</label>
        <input type="text" name="OfferTitle" class="form-control" required />
    </div>

    <div class="col-md-6">
        <label class="form-label">Apply On</label><br />
        <div id="dropdownChecklist" style="position: relative; display: inline-block;">
            <button class="btn btn-outline-primary dropdown-toggle" type="button" style="width: 100%;">
                Select Category
            </button>
            <div id="dropdownMenu" style="display: none; position: absolute; background-color: #fff; min-width: 100%; max-height: 250px; overflow-y: auto; border: 1px solid #ccc; z-index: 1000; padding: 10px; border-radius: 6px;">
                <label style="display: block; margin-bottom: 5px;"><input type="checkbox" value="Option A"> Option A</label>
                <label style="display: block; margin-bottom: 5px;"><input type="checkbox" value="Option B"> Option B</label>
                <label style="display: block; margin-bottom: 5px;"><input type="checkbox" value="Option C"> Option C</label>
                <label style="display: block; margin-bottom: 5px;"><input type="checkbox" value="Option D"> Option D</label>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <label class="form-label">Description</label>
        <textarea name="OfferDescription" class="form-control" rows="3"></textarea>
    </div>

    <div class="col-md-4">
        <label class="form-label">Discount Amount</label>
        <input type="number" step="0.01" name="DiscountAmount" class="form-control" required />
    </div>

    <div class="col-md-4">
        <label class="form-label">Discount Type</label>
        <select name="DiscountType" class="form-select">
            <option value="Percentage">Percentage</option>
            <option value="Flat">Flat</option>
        </select>
    </div>

    <div class="col-md-4">
        <label class="form-label">Effective From</label>
        <input type="date" name="EffectiveFrom" class="form-control" required />
    </div>

    <div class="col-md-4">
        <label class="form-label">Effective To</label>
        <input type="date" name="EffectiveTo" class="form-control" />
    </div>

    <div class="col-md-12 mt-3">
        <button type="submit" class="btn btn-success">Apply Offer</button>
    </div>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <script>
        $(document).ready(function () {
            // Toggle dropdown checklist
            $('#dropdownChecklist button').click(function () {
                $('#dropdownMenu').toggle();
            });

            // Close dropdown if clicked outside
            $(document).click(function (e) {
                if (!$(e.target).closest('#dropdownChecklist').length) {
                    $('#dropdownMenu').hide();
                }
            });

            // Handle form submission
            $('#offerForm').on('submit', function (e) {
                e.preventDefault();

                // Collect selected checklist options
                let selectedOptions = [];
                $('#dropdownMenu input[type="checkbox"]:checked').each(function () {
                    selectedOptions.push($(this).val());
                });

                // Append selected options to form
                $('<input>').attr({
                    type: 'hidden',
                    name: 'SelectedOptions',
                    value: selectedOptions.join(',')
                }).appendTo('#offerForm');

                // Submit via AJAX
                $.ajax({
                    url: '/Offer/ProductOffer',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (response) {
                        $('#offerMessage')
                            .removeClass('d-none alert-danger')
                            .addClass('alert-success')
                            .text(response.message || 'Offer saved successfully!');
                    },
                    error: function () {
                        $('#offerMessage')
                            .removeClass('d-none alert-success')
                            .addClass('alert-danger')
                            .text('Failed to save offer.');
                    }
                });
            });
        });
    </script>
}