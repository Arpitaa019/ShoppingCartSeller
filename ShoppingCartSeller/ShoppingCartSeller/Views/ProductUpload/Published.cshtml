@using ProjectsLibrary.Shared.Enum

<h2 class="mb-4 fw-bold text-primary">🛒 Publish Products</h2>

<!-- Scrollable table container -->
<div class="shadow-sm rounded border" style="max-height: 400px; overflow-y: auto;">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light sticky-top">
            <tr>
                <th style="width: 50px;"><input type="checkbox" id="select-all" /></th>
                <th>Product Name</th>
                <th>Brand Name</th>
                <th>Model Name</th>
                <th>Material</th>
                <th>Color</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model)
            {
                var status = product.ProductMasterModel.Status;
                if (status == ProductStatus.Published)
                {
                    continue;
                }

                var badgeClass = status switch
                {
                    ProductStatus.New => "bg-secondary",
                    ProductStatus.ReadyToReview => "bg-warning text-dark",
                    ProductStatus.UnderReview => "bg-primary",
                    ProductStatus.NeedsCorrection => "bg-danger",
                    ProductStatus.ReadyToView => "bg-info",
                    ProductStatus.ApprovedForPublish => "bg-success text-dark",
                    ProductStatus.Unpublished => "bg-dark text-light",
                    ProductStatus.Archived => "bg-light text-muted",
                    _ => "bg-light text-dark"
                };

                <tr>
                    <td>
                        <input type="checkbox" class="form-check-input publish-checkbox" data-id="@product.ProductMasterModel.ProductId" />
                    </td>
                    <td class="fw-semibold">@product.ProductMasterModel.ProductName</td>
                    <td class="fw-semibold">@product.BrandModel.BrandName</td>
                    <td class="fw-semibold">@product.ProductModel.ModelName</td>
                    <td class="fw-semibold">@product.ProductMasterModel.Material</td>
                    <td class="fw-semibold">@product.ProductMasterModel.Color</td>
                    <td><span class="badge @badgeClass px-3 py-2 rounded-pill">@status</span></td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Fixed button outside scrollable area -->
<div class="d-flex justify-content-end mt-3">
    <button id="publish-btn" class="btn btn-gradient btn-primary px-4 py-2">
        <i class="bi bi-upload me-2"></i> Publish Selected
    </button>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(function () {
            $('#select-all').on('change', function () {
                $('.publish-checkbox').prop('checked', this.checked);
            });

            $('#publish-btn').on('click', function () {
                const ids = $('.publish-checkbox:checked').map(function () {
                    return $(this).data('id');
                }).get();

                if (ids.length === 0) {
                    alert("Please select at least one product.");
                    return;
                }

                $.ajax({
                    url: '/ProductUpload/PublishSelected',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(ids),
                    success: function () {
                        alert("Publish request completed.");
                        location.reload();
                    },
                    error: function (err) {
                        alert("AJAX error: " + err.responseText);
                    }
                });
            });
        });
    </script>
}